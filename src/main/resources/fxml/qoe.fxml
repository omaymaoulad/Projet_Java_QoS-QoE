<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.shape.*?>
<?import javafx.scene.effect.*?>

<ScrollPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.ensah.qoe.Controller.QoEController"
            fitToWidth="true"
            fitToHeight="false"
            hbarPolicy="NEVER"
            vbarPolicy="AS_NEEDED"
            style="-fx-background-color: transparent;"
            styleClass="qoe-scroll-pane">

    <VBox spacing="0" alignment="TOP_CENTER"
          styleClass="qoe-main-container"
          style="-fx-background-color: linear-gradient(to bottom, #fff2f2, #ffffff);">

        <!-- En-tÃªte -->
        <VBox spacing="12" alignment="CENTER" styleClass="qoe-header"
              style="-fx-padding: 25 30 20 30; -fx-background-color: linear-gradient(to right, #f59e0b, #d97706); -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.15), 15, 0, 0, 5);">
            <HBox alignment="CENTER" spacing="18">
                <StackPane>
                    <Rectangle width="55" height="55" arcWidth="15" arcHeight="15"
                               fill="linear-gradient(to bottom right, #fbbf24, #f59e0b)">
                        <effect>
                            <DropShadow color="rgba(251,191,36,0.5)" radius="12" spread="0.4"/>
                        </effect>
                    </Rectangle>
                    <Text text="â­" style="-fx-font-size: 28; -fx-fill: white;"/>
                </StackPane>
                <VBox spacing="3">
                    <Label text="QUALITÃ‰ D'EXPÃ‰RIENCE"
                           styleClass="header-title"
                           style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 28; -fx-font-family: 'Segoe UI'; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.3), 3, 0, 0, 2);"/>
                    <Label text="Tableau de bord de l'expÃ©rience utilisateur"
                           styleClass="header-subtitle"
                           style="-fx-text-fill: #fef3c7; -fx-font-size: 14; -fx-font-family: 'Segoe UI';"/>
                </VBox>
            </HBox>
        </VBox>

        <!-- Conteneur principal responsive -->
        <VBox spacing="20" styleClass="content-container" style="-fx-padding: 20 30 25 30;">

            <!-- QoE Global - Full Width -->
            <VBox spacing="10" alignment="CENTER" styleClass="qoe-global-card"
                  style="-fx-background-color: linear-gradient(to bottom right, #fef3c7, #fde68a); -fx-background-radius: 12; -fx-padding: 20; -fx-border-color: #fbbf24; -fx-border-radius: 12; -fx-border-width: 2; -fx-effect: dropshadow(three-pass-box, rgba(251,191,36,0.3), 12, 0, 0, 4);">
                <Label text="ðŸŽ¯ QoE GLOBAL" style="-fx-text-fill: #92400e; -fx-font-weight: bold; -fx-font-size: 18;"/>
                <Label fx:id="overallQoeLabel" text="-" styleClass="qoe-value-large" style="-fx-text-fill: #d97706; -fx-font-weight: bold; -fx-font-size: 32;"/>
            </VBox>

            <!-- Section MÃ©triques Subjectives -->
            <VBox spacing="15" styleClass="metrics-section">
                <Label text="MÃ‰TRIQUES SUBJECTIVES" styleClass="section-title"
                       style="-fx-text-fill: #f59e0b; -fx-font-weight: bold; -fx-font-size: 18; -fx-border-color: #fbbf24; -fx-border-width: 0 0 2 0; -fx-padding: 10 0 10 0;"/>

                <!-- Grille Responsive avec FlowPane pour adaptation automatique -->
                <GridPane hgap="15" vgap="15" styleClass="metrics-grid">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="50" hgrow="ALWAYS" minWidth="200"/>
                        <ColumnConstraints percentWidth="50" hgrow="ALWAYS" minWidth="200"/>
                    </columnConstraints>

                    <!-- Satisfaction -->
                    <VBox spacing="8" alignment="CENTER_LEFT" GridPane.columnIndex="0" GridPane.rowIndex="0"
                          styleClass="metric-card metric-card-yellow"
                          style="-fx-background-color: linear-gradient(to bottom right, #fef3c7, #fde68a); -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #fbbf24; -fx-border-radius: 12; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 8, 0, 0, 2);">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="ðŸ˜Š" style="-fx-font-size: 20;"/>
                            <Label text="Satisfaction" styleClass="metric-label" style="-fx-text-fill: #92400e; -fx-font-weight: bold; -fx-font-size: 13;"/>
                        </HBox>
                        <Label fx:id="satisfactionLabel" text="-" styleClass="metric-value" style="-fx-text-fill: #d97706; -fx-font-weight: bold; -fx-font-size: 20;"/>
                    </VBox>

                    <!-- Video Quality -->
                    <VBox spacing="8" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="0"
                          styleClass="metric-card metric-card-red"
                          style="-fx-background-color: linear-gradient(to bottom right, #fecaca, #fca5a5); -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #f87171; -fx-border-radius: 12; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 8, 0, 0, 2);">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="ðŸ“¹" style="-fx-font-size: 20;"/>
                            <Label text="QualitÃ© VidÃ©o" styleClass="metric-label" style="-fx-text-fill: #7f1d1d; -fx-font-weight: bold; -fx-font-size: 13;"/>
                        </HBox>
                        <Label fx:id="videoQualityLabel" text="-" styleClass="metric-value" style="-fx-text-fill: #dc2626; -fx-font-weight: bold; -fx-font-size: 20;"/>
                    </VBox>

                    <!-- Audio Quality -->
                    <VBox spacing="8" alignment="CENTER_LEFT" GridPane.columnIndex="0" GridPane.rowIndex="1"
                          styleClass="metric-card metric-card-purple"
                          style="-fx-background-color: linear-gradient(to bottom right, #ddd6fe, #c4b5fd); -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #a78bfa; -fx-border-radius: 12; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 8, 0, 0, 2);">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="ðŸŽµ" style="-fx-font-size: 20;"/>
                            <Label text="QualitÃ© Audio" styleClass="metric-label" style="-fx-text-fill: #4c1d95; -fx-font-weight: bold; -fx-font-size: 13;"/>
                        </HBox>
                        <Label fx:id="audioQualityLabel" text="-" styleClass="metric-value" style="-fx-text-fill: #7c3aed; -fx-font-weight: bold; -fx-font-size: 20;"/>
                    </VBox>

                    <!-- Interactivity -->
                    <VBox spacing="8" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="1"
                          styleClass="metric-card metric-card-blue"
                          style="-fx-background-color: linear-gradient(to bottom right, #bfdbfe, #93c5fd); -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #60a5fa; -fx-border-radius: 12; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 8, 0, 0, 2);">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="âš¡" style="-fx-font-size: 20;"/>
                            <Label text="InteractivitÃ©" styleClass="metric-label" style="-fx-text-fill: #1e3a8a; -fx-font-weight: bold; -fx-font-size: 13;"/>
                        </HBox>
                        <Label fx:id="interactivityLabel" text="-" styleClass="metric-value" style="-fx-text-fill: #2563eb; -fx-font-weight: bold; -fx-font-size: 20;"/>
                    </VBox>

                    <!-- Reliability -->
                    <VBox spacing="8" alignment="CENTER_LEFT" GridPane.columnIndex="0" GridPane.rowIndex="2"
                          styleClass="metric-card metric-card-green"
                          style="-fx-background-color: linear-gradient(to bottom right, #d1fae5, #a7f3d0); -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #34d399; -fx-border-radius: 12; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 8, 0, 0, 2);">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="ðŸ›¡ï¸" style="-fx-font-size: 20;"/>
                            <Label text="FiabilitÃ©" styleClass="metric-label" style="-fx-text-fill: #065f46; -fx-font-weight: bold; -fx-font-size: 13;"/>
                        </HBox>
                        <Label fx:id="reliabilityLabel" text="-" styleClass="metric-value" style="-fx-text-fill: #059669; -fx-font-weight: bold; -fx-font-size: 20;"/>
                    </VBox>

                    <!-- Streaming Quality -->
                    <VBox spacing="8" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="2"
                          styleClass="metric-card metric-card-cyan"
                          style="-fx-background-color: linear-gradient(to bottom right, #cffafe, #a5f3fc); -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #22d3ee; -fx-border-radius: 12; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 8, 0, 0, 2);">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="ðŸ“¡" style="-fx-font-size: 20;"/>
                            <Label text="QualitÃ© Streaming" styleClass="metric-label" style="-fx-text-fill: #164e63; -fx-font-weight: bold; -fx-font-size: 13;"/>
                        </HBox>
                        <Label fx:id="streamingQualityLabel" text="-" styleClass="metric-value" style="-fx-text-fill: #0891b2; -fx-font-weight: bold; -fx-font-size: 20;"/>
                    </VBox>
                </GridPane>
            </VBox>

            <!-- Section MÃ©triques Objectives -->
            <VBox spacing="15" styleClass="metrics-section">
                <Label text="MÃ‰TRIQUES OBJECTIVES" styleClass="section-title"
                       style="-fx-text-fill: #f59e0b; -fx-font-weight: bold; -fx-font-size: 18; -fx-border-color: #fbbf24; -fx-border-width: 0 0 2 0; -fx-padding: 10 0 10 0;"/>

                <GridPane hgap="15" vgap="15" styleClass="objective-metrics-grid">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="33.33" hgrow="ALWAYS" minWidth="150"/>
                        <ColumnConstraints percentWidth="33.33" hgrow="ALWAYS" minWidth="150"/>
                        <ColumnConstraints percentWidth="33.33" hgrow="ALWAYS" minWidth="150"/>
                    </columnConstraints>

                    <VBox spacing="8" alignment="CENTER" GridPane.columnIndex="0" styleClass="objective-card"
                          style="-fx-background-color: #f8f9fa; -fx-background-radius: 10; -fx-padding: 12; -fx-border-color: #dee2e6; -fx-border-radius: 10; -fx-border-width: 1;">
                        <Label text="â³ Buffering" style="-fx-text-fill: #495057; -fx-font-weight: bold; -fx-font-size: 11;"/>
                        <Label fx:id="bufferingLabel" text="-" style="-fx-text-fill: #6c757d; -fx-font-weight: bold; -fx-font-size: 16;"/>
                    </VBox>

                    <VBox spacing="8" alignment="CENTER" GridPane.columnIndex="1" styleClass="objective-card"
                          style="-fx-background-color: #f8f9fa; -fx-background-radius: 10; -fx-padding: 12; -fx-border-color: #dee2e6; -fx-border-radius: 10; -fx-border-width: 1;">
                        <Label text="â±ï¸ Loading Time" style="-fx-text-fill: #495057; -fx-font-weight: bold; -fx-font-size: 11;"/>
                        <Label fx:id="loadingTimeLabel" text="-" style="-fx-text-fill: #6c757d; -fx-font-weight: bold; -fx-font-size: 16;"/>
                    </VBox>

                    <VBox spacing="8" alignment="CENTER" GridPane.columnIndex="2" styleClass="objective-card"
                          style="-fx-background-color: #f8f9fa; -fx-background-radius: 10; -fx-padding: 12; -fx-border-color: #dee2e6; -fx-border-radius: 10; -fx-border-width: 1;">
                        <Label text="âŒ Failure Rate" style="-fx-text-fill: #495057; -fx-font-weight: bold; -fx-font-size: 11;"/>
                        <Label fx:id="failureRateLabel" text="-" style="-fx-text-fill: #6c757d; -fx-font-weight: bold; -fx-font-size: 16;"/>
                    </VBox>
                </GridPane>
            </VBox>

            <!-- Section Contexte -->
            <VBox spacing="15" styleClass="context-section">
                <Label text="INFORMATIONS CONTEXTUELLES" styleClass="section-title"
                       style="-fx-text-fill: #f59e0b; -fx-font-weight: bold; -fx-font-size: 18; -fx-border-color: #fbbf24; -fx-border-width: 0 0 2 0; -fx-padding: 10 0 10 0;"/>

                <HBox spacing="15" styleClass="context-cards">
                    <VBox spacing="8" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS" styleClass="context-card"
                          style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-border-color: #e5e7eb; -fx-border-radius: 10; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 8, 0, 0, 2);">
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <Label text="ðŸ“±" style="-fx-font-size: 16;"/>
                            <Label text="Appareil" style="-fx-text-fill: #6b7280; -fx-font-size: 11;"/>
                        </HBox>
                        <Label fx:id="deviceTypeLabel" text="-" style="-fx-text-fill: #1f2937; -fx-font-weight: bold; -fx-font-size: 15;"/>
                    </VBox>

                    <VBox spacing="8" alignment="CENTER_LEFT" HBox.hgrow="ALWAYS" styleClass="context-card"
                          style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 15; -fx-border-color: #e5e7eb; -fx-border-radius: 10; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 8, 0, 0, 2);">
                        <HBox spacing="8" alignment="CENTER_LEFT">
                            <Label text="ðŸŽ¬" style="-fx-font-size: 16;"/>
                            <Label text="Service" style="-fx-text-fill: #6b7280; -fx-font-size: 11;"/>
                        </HBox>
                        <Label fx:id="serviceTypeLabel" text="-" style="-fx-text-fill: #1f2937; -fx-font-weight: bold; -fx-font-size: 15;"/>
                    </VBox>
                </HBox>
            </VBox>

            <!-- Zone d'analyse -->
            <VBox spacing="15" alignment="CENTER" styleClass="analysis-section"
                  style="-fx-padding: 20 0 0 0; -fx-border-color: #e5e7eb; -fx-border-width: 2 0 0 0;">
                <Label text="ANALYSE DES DONNÃ‰ES QoE" styleClass="section-title"
                       style="-fx-text-fill: #f59e0b; -fx-font-weight: bold; -fx-font-size: 18;"/>

                <Button fx:id="analyserButton" text="ðŸ“ Analyser le fichier CSV" onAction="#analyserQoE"
                        styleClass="analyze-button"
                        style="-fx-background-color: linear-gradient(to right, #f59e0b, #d97706); -fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 15; -fx-background-radius: 10; -fx-padding: 14 40; -fx-cursor: hand; -fx-effect: dropshadow(three-pass-box, rgba(245,158,11,0.4), 12, 0, 0, 4); -fx-border-color: rgba(255,255,255,0.3); -fx-border-radius: 10; -fx-border-width: 1;"/>

                <Label text="Importez un fichier CSV contenant les donnÃ©es d'expÃ©rience utilisateur"
                       styleClass="analysis-hint"
                       style="-fx-text-fill: #6b7280; -fx-font-size: 12; -fx-font-style: italic; -fx-text-alignment: center; -fx-wrap-text: true;"/>
            </VBox>

            <!-- Section Info Format CSV -->
            <VBox spacing="12" styleClass="info-section"
                  style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 20; -fx-border-color: #e5e7eb; -fx-border-radius: 12; -fx-border-width: 1; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 10, 0, 0, 3);">
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <Label text="â„¹ï¸" style="-fx-font-size: 18;"/>
                    <Label text="FORMAT CSV ATTENDU" style="-fx-text-fill: #f59e0b; -fx-font-weight: bold; -fx-font-size: 16;"/>
                </HBox>

                <VBox spacing="6">
                    <Label text="Colonnes requises:" style="-fx-text-fill: #1f2937; -fx-font-size: 12; -fx-font-weight: bold;"/>
                    <Label text="â€¢ Satisfaction, VideoQuality, AudioQuality, Interactivity, Reliability (scores 1-5)"
                           style="-fx-text-fill: #6b7280; -fx-font-size: 11; -fx-wrap-text: true;"/>
                    <Label text="â€¢ Buffering, LoadingTime (en secondes), FailureRate (en %)"
                           style="-fx-text-fill: #6b7280; -fx-font-size: 11; -fx-wrap-text: true;"/>
                    <Label text="â€¢ ServiceType, DeviceType, UserId"
                           style="-fx-text-fill: #6b7280; -fx-font-size: 11; -fx-wrap-text: true;"/>
                </VBox>
            </VBox>

            <!-- Pied de page -->
            <HBox alignment="CENTER" styleClass="footer"
                  style="-fx-padding: 20 0 10 0;">
                <Label text="QoE Analysis System â€¢ Quality of Experience â€¢ v2.0 â€¢ Â© 2024"
                       style="-fx-text-fill: #9ca3af; -fx-font-size: 11; -fx-font-family: 'Segoe UI';"/>
            </HBox>

        </VBox>
    </VBox>
</ScrollPane>