<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.scene.shape.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.ensah.qoe.Controller.QoEController"
            style="-fx-background-color: #f8fafc;">

    <!-- ==================== TOP NAVIGATION BAR ==================== -->
    <top>
        <VBox spacing="0"
              style="-fx-background-color: linear-gradient(to right, #2c3e50, #34495e);
                     -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 8, 0, 0, 2);">

            <!-- Header -->
            <HBox alignment="CENTER_LEFT" spacing="20"
                  style="-fx-padding: 20 40;">
                <StackPane>
                    <Circle radius="24" fill="rgba(245, 158, 11, 0.2)"/>
                    <Text text="â­" style="-fx-font-size: 24;"/>
                </StackPane>

                <VBox spacing="2">
                    <Label text="Quality of Experience"
                           style="-fx-text-fill: white;
                                  -fx-font-size: 24;
                                  -fx-font-weight: 700;"/>
                    <Label text="Dashboard d'analyse de l'expÃ©rience utilisateur"
                           style="-fx-text-fill: rgba(255,255,255,0.8);
                                  -fx-font-size: 13;"/>
                </VBox>

                <!-- Spacer -->
                <Region HBox.hgrow="ALWAYS"/>

                <!-- Import Button -->
                <Button fx:id="importCsvButton"
                        text="ðŸ“ Importer CSV"
                        onAction="#importerCsv"
                        style="-fx-background-color: #f59e0b;
                               -fx-text-fill: white;
                               -fx-font-size: 13;
                               -fx-font-weight: 600;
                               -fx-background-radius: 8;
                               -fx-padding: 12 24;
                               -fx-cursor: hand;"/>
            </HBox>

            <!-- Filter Navigation Tabs -->
            <HBox spacing="0" alignment="CENTER_LEFT"
                  style="-fx-background-color: rgba(0,0,0,0.1);
                         -fx-padding: 0 40;">

                <ToggleButton fx:id="radioGenre"
                              text="ðŸ“Š Par Genre"
                              onAction="#modeGenre"
                              style="-fx-background-color: transparent;
                                     -fx-text-fill: rgba(255,255,255,0.8);
                                     -fx-font-size: 14;
                                     -fx-font-weight: 600;
                                     -fx-padding: 16 40;
                                     -fx-min-width: 180;
                                     -fx-background-radius: 0;
                                     -fx-border-width: 0 0 3 0;
                                     -fx-border-color: transparent;
                                     -fx-cursor: hand;">
                    <toggleGroup>
                        <ToggleGroup fx:id="filterGroup"/>
                    </toggleGroup>
                </ToggleButton>

                <ToggleButton fx:id="radioClient"
                              text="ðŸ‘¥ Par Client"
                              onAction="#modeClient"
                              toggleGroup="$filterGroup"
                              style="-fx-background-color: transparent;
                                     -fx-text-fill: rgba(255,255,255,0.8);
                                     -fx-font-size: 14;
                                     -fx-font-weight: 600;
                                     -fx-padding: 16 40;
                                     -fx-min-width: 180;
                                     -fx-background-radius: 0;
                                     -fx-border-width: 0 0 3 0;
                                     -fx-border-color: transparent;
                                     -fx-cursor: hand;"/>

                <ToggleButton fx:id="radioZone"
                              text="ðŸ—º Par Zone"
                              onAction="#modeZone"
                              toggleGroup="$filterGroup"
                              style="-fx-background-color: transparent;
                                     -fx-text-fill: rgba(255,255,255,0.8);
                                     -fx-font-size: 14;
                                     -fx-font-weight: 600;
                                     -fx-padding: 16 40;
                                     -fx-min-width: 180;
                                     -fx-background-radius: 0;
                                     -fx-border-width: 0 0 3 0;
                                     -fx-border-color: transparent;
                                     -fx-cursor: hand;"/>

                <!-- Spacer -->
                <Region HBox.hgrow="ALWAYS"/>

                <!-- Genre SubMenu (visible quand mode Genre est actif) -->
                <HBox fx:id="genreSubMenu" spacing="12" visible="false" alignment="CENTER"
                      style="-fx-padding: 8 0;">
                    <Label text="Genre:"
                           style="-fx-text-fill: rgba(255,255,255,0.9); -fx-font-weight: 600; -fx-font-size: 13;"/>
                    <ComboBox fx:id="sexeCombo"
                              promptText="Male / Female"
                              style="-fx-pref-width: 150; -fx-background-radius: 6;"/>
                </HBox>

                <!-- Zone SubMenu (visible quand mode Zone est actif) -->
                <HBox fx:id="zoneSubMenu" spacing="12" visible="false" alignment="CENTER"
                      style="-fx-padding: 8 0;">
                    <Label text="SÃ©lectionner:"
                           style="-fx-text-fill: rgba(255,255,255,0.9); -fx-font-weight: 600; -fx-font-size: 13;"/>
                    <ComboBox fx:id="zoneCombo"
                              promptText="Choisir une zone..."
                              style="-fx-pref-width: 200; -fx-background-radius: 6;"/>
                    <Button fx:id="allZonesButton"
                            text=" Toutes les zones"
                            onAction="#afficherToutesLesZones"
                            style="-fx-background-color: rgba(245, 158, 11, 0.2);
                                   -fx-text-fill: #fbbf24;
                                   -fx-font-size: 12;
                                   -fx-font-weight: 600;
                                   -fx-background-radius: 6;
                                   -fx-padding: 8 16;
                                   -fx-cursor: hand;"/>
                </HBox>
            </HBox>
        </VBox>
    </top>

    <!-- ==================== MAIN CONTENT ==================== -->
    <center>
        <ScrollPane fitToWidth="true" fitToHeight="true"
                    vbarPolicy="AS_NEEDED"
                    style="-fx-background: transparent; -fx-background-color: transparent;">

            <!-- HBox principal contenant mÃ©triques + contenu dynamique -->
            <HBox fx:id="mainContentBox" spacing="24" alignment="TOP_LEFT"
                  style="-fx-padding: 32 40;">

                <!-- ==================== COLONNE GAUCHE: MÃ‰TRIQUES ==================== -->
                <VBox fx:id="metricsColumn" spacing="24"
                      style="-fx-pref-width: 100%;">

                    <!-- QOE GLOBAL CARD -->
                    <HBox fx:id="qoeGlobalSection" spacing="24" alignment="CENTER">

                        <!-- QoE Global Principal -->
                        <StackPane style="-fx-background-color: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
                                          -fx-background-radius: 20;
                                          -fx-padding: 32;
                                          -fx-pref-width: 350;
                                          -fx-pref-height: 200;
                                          -fx-effect: dropshadow(gaussian, rgba(245,158,11,0.4), 20, 0, 0, 8);">
                            <VBox spacing="8" alignment="CENTER">
                                <HBox spacing="12" alignment="CENTER">
                                    <Text text="ðŸŽ¯" style="-fx-font-size: 28;"/>
                                    <Label text="QoE GLOBAL"
                                           style="-fx-text-fill: #78350f;
                                                  -fx-font-size: 18;
                                                  -fx-font-weight: 700;
                                                  -fx-letter-spacing: 2;"/>
                                </HBox>

                                <Label fx:id="overallQoeLabel"
                                       text="â€”"
                                       style="-fx-text-fill: #92400e;
                                              -fx-font-size: 48;
                                              -fx-font-weight: 700;
                                              -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 4, 0, 0, 2);"/>

                                <Label text="Score moyen de qualitÃ©"
                                       style="-fx-text-fill: #78350f;
                                              -fx-font-size: 13;
                                              -fx-font-weight: 600;"/>
                            </VBox>
                        </StackPane>

                        <!-- Quick Stats -->
                        <GridPane fx:id="quickStatsGrid" hgap="16" vgap="16" HBox.hgrow="ALWAYS">

                            <!-- Buffering -->
                            <VBox GridPane.columnIndex="0" GridPane.rowIndex="0"
                                  spacing="8" alignment="CENTER"
                                  style="-fx-background-color: white;
                                         -fx-background-radius: 16;
                                         -fx-padding: 16;
                                         -fx-pref-width: 160;
                                         -fx-pref-height: 90;
                                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 12, 0, 0, 4);">
                                <Text text="â³" style="-fx-font-size: 24;"/>
                                <Label text="Jitter Moyen"
                                       style="-fx-font-size: 11;
                                              -fx-text-fill: #64748b;
                                              -fx-font-weight: 600;"/>
                                <Label fx:id="bufferingLabel"
                                       text="â€”"
                                       style="-fx-font-size: 16;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #f59e0b;"/>
                            </VBox>

                            <!-- Loading Time -->
                            <VBox GridPane.columnIndex="1" GridPane.rowIndex="0"
                                  spacing="8" alignment="CENTER"
                                  style="-fx-background-color: white;
                                         -fx-background-radius: 16;
                                         -fx-padding: 16;
                                         -fx-pref-width: 160;
                                         -fx-pref-height: 90;
                                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 12, 0, 0, 4);">
                                <Text text="â±" style="-fx-font-size: 24;"/>
                                <Label text="Latence Moy."
                                       style="-fx-font-size: 11;
                                              -fx-text-fill: #64748b;
                                              -fx-font-weight: 600;"/>
                                <Label fx:id="loadingTimeLabel"
                                       text="â€”"
                                       style="-fx-font-size: 16;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #3b82f6;"/>
                            </VBox>

                            <!-- Failure Rate -->
                            <VBox GridPane.columnIndex="0" GridPane.rowIndex="1"
                                  spacing="8" alignment="CENTER"
                                  style="-fx-background-color: white;
                                         -fx-background-radius: 16;
                                         -fx-padding: 16;
                                         -fx-pref-width: 160;
                                         -fx-pref-height: 90;
                                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 12, 0, 0, 4);">
                                <Text text="âŒ" style="-fx-font-size: 24;"/>
                                <Label text="Perte Moy."
                                       style="-fx-font-size: 11;
                                              -fx-text-fill: #64748b;
                                              -fx-font-weight: 600;"/>
                                <Label fx:id="failureRateLabel"
                                       text="â€”"
                                       style="-fx-font-size: 16;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #ef4444;"/>
                            </VBox>

                            <!-- Streaming -->
                            <VBox GridPane.columnIndex="1" GridPane.rowIndex="1"
                                  spacing="8" alignment="CENTER"
                                  style="-fx-background-color: white;
                                         -fx-background-radius: 16;
                                         -fx-padding: 16;
                                         -fx-pref-width: 160;
                                         -fx-pref-height: 90;
                                         -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 12, 0, 0, 4);">
                                <Text text="ðŸ“¶" style="-fx-font-size: 24;"/>
                                <Label text="Bande Passante"
                                       style="-fx-font-size: 11;
                                              -fx-text-fill: #64748b;
                                              -fx-font-weight: 600;"/>
                                <Label fx:id="streamingQualityLabel"
                                       text="â€”"
                                       style="-fx-font-size: 16;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #10b981;"/>
                            </VBox>
                        </GridPane>
                    </HBox>

                    <!-- MÃ‰TRIQUES SUBJECTIVES -->
                    <VBox fx:id="subjectiveMetricsBox" spacing="20"
                          style="-fx-background-color: white;
                                 -fx-background-radius: 20;
                                 -fx-padding: 28;
                                 -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 16, 0, 0, 4);">

                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <StackPane>
                                <Circle radius="18" fill="#fbbf24" opacity="0.2"/>
                                <Text text="ðŸ’­" style="-fx-font-size: 20;"/>
                            </StackPane>
                            <Label text="MÃ‰TRIQUES SUBJECTIVES"
                                   style="-fx-text-fill: #0f172a;
                                          -fx-font-size: 17;
                                          -fx-font-weight: 700;
                                          -fx-letter-spacing: 1;"/>
                        </HBox>

                        <GridPane hgap="16" vgap="16">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="50"/>
                                <ColumnConstraints percentWidth="50"/>
                            </columnConstraints>

                            <!-- Satisfaction -->
                            <VBox GridPane.columnIndex="0" GridPane.rowIndex="0"
                                  spacing="8"
                                  style="-fx-background-color: #fffbeb;
                                         -fx-background-radius: 14;
                                         -fx-padding: 16;
                                         -fx-border-color: #fbbf24;
                                         -fx-border-width: 2;
                                         -fx-border-radius: 14;">
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <StackPane>
                                        <Circle radius="16" fill="#fbbf24" opacity="0.2"/>
                                        <Text text="ðŸ˜Š" style="-fx-font-size: 16;"/>
                                    </StackPane>
                                    <Label text="Satisfaction"
                                           style="-fx-font-size: 13;
                                                  -fx-font-weight: 700;
                                                  -fx-text-fill: #78350f;"/>
                                </HBox>

                                <Label fx:id="satisfactionLabel"
                                       text="â€”"
                                       style="-fx-font-size: 32;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #f59e0b;
                                              -fx-padding: 2 0 0 0;"/>
                            </VBox>

                            <!-- QualitÃ© VidÃ©o -->
                            <VBox GridPane.columnIndex="1" GridPane.rowIndex="0"
                                  spacing="8"
                                  style="-fx-background-color: #fef2f2;
                                         -fx-background-radius: 14;
                                         -fx-padding: 16;
                                         -fx-border-color: #ef4444;
                                         -fx-border-width: 2;
                                         -fx-border-radius: 14;">
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <StackPane>
                                        <Circle radius="16" fill="#ef4444" opacity="0.2"/>
                                        <Text text="ðŸ“¹" style="-fx-font-size: 16;"/>
                                    </StackPane>
                                    <Label text="QualitÃ© VidÃ©o"
                                           style="-fx-font-size: 13;
                                                  -fx-font-weight: 700;
                                                  -fx-text-fill: #7f1d1d;"/>
                                </HBox>

                                <Label fx:id="videoQualityLabel"
                                       text="â€”"
                                       style="-fx-font-size: 32;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #ef4444;
                                              -fx-padding: 2 0 0 0;"/>
                            </VBox>

                            <!-- QualitÃ© Audio -->
                            <VBox GridPane.columnIndex="0" GridPane.rowIndex="1"
                                  spacing="8"
                                  style="-fx-background-color: #faf5ff;
                                         -fx-background-radius: 14;
                                         -fx-padding: 16;
                                         -fx-border-color: #8b5cf6;
                                         -fx-border-width: 2;
                                         -fx-border-radius: 14;">
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <StackPane>
                                        <Circle radius="16" fill="#8b5cf6" opacity="0.2"/>
                                        <Text text="ðŸŽµ" style="-fx-font-size: 16;"/>
                                    </StackPane>
                                    <Label text="QualitÃ© Audio"
                                           style="-fx-font-size: 13;
                                                  -fx-font-weight: 700;
                                                  -fx-text-fill: #581c87;"/>
                                </HBox>

                                <Label fx:id="audioQualityLabel"
                                       text="â€”"
                                       style="-fx-font-size: 32;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #8b5cf6;
                                              -fx-padding: 2 0 0 0;"/>
                            </VBox>

                            <!-- InteractivitÃ© -->
                            <VBox GridPane.columnIndex="1" GridPane.rowIndex="1"
                                  spacing="8"
                                  style="-fx-background-color: #eff6ff;
                                         -fx-background-radius: 14;
                                         -fx-padding: 16;
                                         -fx-border-color: #3b82f6;
                                         -fx-border-width: 2;
                                         -fx-border-radius: 14;">
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <StackPane>
                                        <Circle radius="16" fill="#3b82f6" opacity="0.2"/>
                                        <Text text="âš¡" style="-fx-font-size: 16;"/>
                                    </StackPane>
                                    <Label text="InteractivitÃ©"
                                           style="-fx-font-size: 13;
                                                  -fx-font-weight: 700;
                                                  -fx-text-fill: #1e3a8a;"/>
                                </HBox>

                                <Label fx:id="interactivityLabel"
                                       text="â€”"
                                       style="-fx-font-size: 32;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #3b82f6;
                                              -fx-padding: 2 0 0 0;"/>
                            </VBox>

                            <!-- FiabilitÃ© -->
                            <VBox GridPane.columnIndex="0" GridPane.rowIndex="2"
                                  GridPane.columnSpan="2"
                                  spacing="8"
                                  style="-fx-background-color: #f0fdf4;
                                         -fx-background-radius: 14;
                                         -fx-padding: 16;
                                         -fx-border-color: #10b981;
                                         -fx-border-width: 2;
                                         -fx-border-radius: 14;">
                                <HBox spacing="8" alignment="CENTER_LEFT">
                                    <StackPane>
                                        <Circle radius="16" fill="#10b981" opacity="0.2"/>
                                        <Text text="ðŸ›¡ï¸" style="-fx-font-size: 16;"/>
                                    </StackPane>
                                    <Label text="FiabilitÃ©"
                                           style="-fx-font-size: 13;
                                                  -fx-font-weight: 700;
                                                  -fx-text-fill: #064e3b;"/>
                                </HBox>

                                <Label fx:id="reliabilityLabel"
                                       text="â€”"
                                       style="-fx-font-size: 32;
                                              -fx-font-weight: 700;
                                              -fx-text-fill: #10b981;
                                              -fx-padding: 2 0 0 0;"/>
                            </VBox>
                        </GridPane>
                    </VBox>
                </VBox>

                <!-- ==================== COLONNE DROITE: CONTENU DYNAMIQUE ==================== -->
                <VBox fx:id="dynamicContentColumn" spacing="20" visible="false" managed="false"
                      HBox.hgrow="ALWAYS">

                    <!-- TABLE VIEW (Clients) -->
                    <VBox fx:id="tableContainer"
                          visible="false"
                          managed="false"
                          spacing="20"
                          style="
                                -fx-background-color: white;
                                -fx-background-radius: 20;
                                -fx-padding: 32;
                                -fx-min-width: 420;
                                -fx-pref-width: 480;
                                -fx-max-width: 520;
                                -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 16, 0, 0, 4);
                          ">
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <StackPane>
                                <Circle radius="18" fill="#3b82f6" opacity="0.2"/>
                                <Text text="ðŸ‘¥" style="-fx-font-size: 20;"/>
                            </StackPane>
                            <Label text="LISTE DES CLIENTS"
                                   style="-fx-font-size: 18;
                                          -fx-font-weight: 700;
                                          -fx-text-fill: #0f172a;
                                          -fx-letter-spacing: 1;"/>

                            <Region HBox.hgrow="ALWAYS"/>

                            <Label fx:id="clientCountLabel"
                                   text="0 clients"
                                   style="-fx-font-size: 13;
                                          -fx-text-fill: #64748b;
                                          -fx-font-weight: 600;"/>
                        </HBox>

                        <!-- SÃ©lection client -->
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <Label text="SÃ©lectionner un client:"
                                   style="-fx-font-weight: 600; -fx-font-size: 13; -fx-text-fill: #475569;"/>
                            <ComboBox fx:id="clientCombo"
                                      promptText="Choisir un client..."
                                      style="-fx-pref-width: 300;"/>
                        </HBox>

                        <TableView fx:id="clientTable"
                                   VBox.vgrow="ALWAYS"
                                   style="-fx-background-color: transparent;
                                          -fx-background-radius: 12;"/>
                    </VBox>

                    <!-- GRAPH VIEW (Genres) -->
                    <VBox fx:id="graphContainer"
                          visible="false"
                          managed="false"
                          spacing="20"
                          style="-fx-background-color: white;
                                 -fx-background-radius: 20;
                                 -fx-padding: 32;
                                 -fx-min-width: 420;
                                 -fx-pref-width: 480;
                                 -fx-max-width: 520;
                                 -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 16, 0, 0, 4);">

                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <StackPane>
                                <Circle radius="18" fill="#8b5cf6" opacity="0.2"/>
                                <Text text="ðŸ“Š" style="-fx-font-size: 20;"/>
                            </StackPane>
                            <Label text="ANALYSE PAR GENRE"
                                   style="-fx-font-size: 18;
                                          -fx-font-weight: 700;
                                          -fx-text-fill: #0f172a;
                                          -fx-letter-spacing: 1;"/>
                        </HBox>

                        <!-- SÃ©lection genre -->
                        <HBox spacing="12" alignment="CENTER_LEFT">
                            <Label text="SÃ©lectionner un genre:"
                                   style="-fx-font-weight: 600; -fx-font-size: 13; -fx-text-fill: #475569;"/>
                            <ComboBox fx:id="genreCombo"
                                      promptText="Choisir un genre..."
                                      style="-fx-pref-width: 250;"/>
                        </HBox>
                    </VBox>

                    <!-- MAP VIEW (Zones) -->
                    <VBox fx:id="mapContainer"
                          visible="false"
                          managed="false"
                          spacing="20"
                          style="-fx-background-color: white;
                                 -fx-background-radius: 20;
                                 -fx-padding: 32;
                                 -fx-min-width: 420;
                                 -fx-pref-width: 480;
                                 -fx-max-width: 520;
                                 -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.08), 16, 0, 0, 4);">

                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <StackPane>
                                <Circle radius="18" fill="#10b981" opacity="0.2"/>
                                <Text text="ðŸ—º" style="-fx-font-size: 20;"/>
                            </StackPane>
                            <Label fx:id="mapTitleLabel"
                                   text="CARTE GÃ‰OGRAPHIQUE"
                                   style="-fx-font-size: 18;
                                          -fx-font-weight: 700;
                                          -fx-text-fill: #0f172a;
                                          -fx-letter-spacing: 1;"/>
                        </HBox>

                        <!-- Placeholder pour la carte -->
                        <VBox fx:id="mapPlaceholder" spacing="16" alignment="CENTER"
                              style="-fx-padding: 80;
                                     -fx-background-color: #f1f5f9;
                                     -fx-background-radius: 12;">
                            <Text text="ðŸ—º" style="-fx-font-size: 64;"/>
                            <Label text="Carte gÃ©ographique"
                                   style="-fx-font-size: 18; -fx-text-fill: #64748b; -fx-font-weight: 600;"/>
                            <Label text="Cliquez pour ouvrir la vue complÃ¨te"
                                   style="-fx-font-size: 14; -fx-text-fill: #94a3b8;"/>
                            <Button fx:id="openMapButton"
                                    text="ðŸ“ Ouvrir la carte"
                                    style="-fx-background-color: #10b981;
                                           -fx-text-fill: white;
                                           -fx-font-size: 14;
                                           -fx-font-weight: 600;
                                           -fx-background-radius: 8;
                                           -fx-padding: 12 32;
                                           -fx-cursor: hand;"/>
                        </VBox>
                    </VBox>
                </VBox>

            </HBox>
        </ScrollPane>
    </center>

</BorderPane>