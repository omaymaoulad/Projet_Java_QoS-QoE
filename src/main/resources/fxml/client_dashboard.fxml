<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.ensah.qoe.Controller.ClientDashboardController"
            stylesheets="@../css/client-dashboard.css"
            prefWidth="1400" prefHeight="900">

    <!-- Header -->
    <top>
        <VBox styleClass="gradient-header">
            <HBox alignment="CENTER_LEFT" spacing="20">
                <Label text="Tableau de Bord QoE" styleClass="header-title"/>
                <Region HBox.hgrow="ALWAYS"/>
                <VBox alignment="CENTER_RIGHT" spacing="3">
                    <Label fx:id="usernameLabel" text="Utilisateur" styleClass="username-label"/>
                    <Label text="Client Premium" styleClass="user-subtitle"/>
                </VBox>
                <Button text="DÃ©connexion" onAction="#handleLogout" styleClass="logout-button"/>
            </HBox>
        </VBox>
    </top>

    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE" styleClass="main-tab-pane">

            <!-- ==================== ONGLET TABLEAU DE BORD ==================== -->
            <Tab text="Tableau de Bord" styleClass="dashboard-tab">
                <ScrollPane fitToWidth="true" styleClass="main-scroll">
                    <VBox spacing="25" style="-fx-padding: 30;">

                        <!-- Score QoE Global - Card Principal -->
                        <VBox spacing="15" styleClass="hero-card">
                            <Label text="Score QoE Global" styleClass="hero-title"/>
                            <HBox alignment="CENTER_LEFT" spacing="20">
                                <Label fx:id="overallQoELabel" text="4.2" styleClass="hero-score"/>
                                <VBox spacing="5">
                                    <Label text="Excellent" styleClass="hero-status"/>
                                    <Label text="â†‘ AmÃ©lioration continue" styleClass="hero-trend"/>
                                </VBox>
                            </HBox>
                        </VBox>

                        <!-- MÃ©triques Principales -->
                        <GridPane hgap="20" vgap="20" styleClass="metrics-grid">
                            <!-- Satisfaction -->
                            <VBox spacing="12" styleClass="metric-card metric-satisfaction"
                                  GridPane.columnIndex="0" GridPane.rowIndex="0">
                                <Label text="Satisfaction" styleClass="metric-label"/>
                                <Label fx:id="satisfactionScore" text="4.5/5" styleClass="metric-value"/>
                                <ProgressBar progress="0.9" prefWidth="150" prefHeight="8" styleClass="progress-satisfaction"/>
                            </VBox>

                            <!-- QualitÃ© VidÃ©o -->
                            <VBox spacing="12" styleClass="metric-card metric-video"
                                  GridPane.columnIndex="1" GridPane.rowIndex="0">
                                <Label text="QualitÃ© VidÃ©o" styleClass="metric-label"/>
                                <Label fx:id="videoQualityLabel" text="4.3/5" styleClass="metric-value"/>
                                <ProgressBar progress="0.86" prefWidth="150" prefHeight="8" styleClass="progress-video"/>
                            </VBox>

                            <!-- QualitÃ© Audio -->
                            <VBox spacing="12" styleClass="metric-card metric-audio"
                                  GridPane.columnIndex="2" GridPane.rowIndex="0">
                                <Label text=" QualitÃ© Audio" styleClass="metric-label"/>
                                <Label fx:id="audioQualityLabel" text="4.7/5" styleClass="metric-value"/>
                                <ProgressBar progress="0.94" prefWidth="150" prefHeight="8" styleClass="progress-audio"/>
                            </VBox>

                            <!-- FiabilitÃ© -->
                            <VBox spacing="12" styleClass="metric-card metric-reliability"
                                  GridPane.columnIndex="3" GridPane.rowIndex="0">
                                <Label text="FiabilitÃ©" styleClass="metric-label"/>
                                <Label fx:id="reliabilityLabel" text="4.1/5" styleClass="metric-value"/>
                                <ProgressBar progress="0.82" prefWidth="150" prefHeight="8" styleClass="progress-reliability"/>
                            </VBox>
                        </GridPane>

                        <!-- Graphiques -->
                        <HBox spacing="20" prefHeight="400">
                            <VBox styleClass="chart-card" HBox.hgrow="ALWAYS">
                                <Label text=" Ã‰volution du Score QoE" styleClass="chart-title"/>
                                <LineChart fx:id="qoeTrendChart" VBox.vgrow="ALWAYS" legendVisible="false">
                                    <xAxis><CategoryAxis label="PÃ©riode" /></xAxis>
                                    <yAxis><NumberAxis label="Score" lowerBound="0" upperBound="5" /></yAxis>
                                </LineChart>
                            </VBox>

                            <VBox styleClass="chart-card" HBox.hgrow="ALWAYS">
                                <Label text=" RÃ©partition par Service" styleClass="chart-title"/>
                                <PieChart fx:id="serviceDistributionChart" VBox.vgrow="ALWAYS" legendSide="BOTTOM"/>
                            </VBox>
                        </HBox>

                        <!-- MÃ©triques Techniques -->
                        <VBox spacing="15" styleClass="technical-metrics-card">
                            <Label text=" MÃ©triques Techniques DÃ©taillÃ©es" styleClass="section-title"/>
                            <GridPane hgap="30" vgap="20">
                                <VBox spacing="8" styleClass="tech-metric" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                    <Label text=" Temps de Chargement" styleClass="tech-label"/>
                                    <Label fx:id="loadingTimeLabel" text="1.2s" styleClass="tech-value tech-loading"/>
                                </VBox>
                                <VBox spacing="8" styleClass="tech-metric" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                    <Label text=" Buffering" styleClass="tech-label"/>
                                    <Label fx:id="bufferingLabel" text="0.5%" styleClass="tech-value tech-buffering"/>
                                </VBox>
                                <VBox spacing="8" styleClass="tech-metric" GridPane.columnIndex="2" GridPane.rowIndex="0">
                                    <Label text=" Taux d'Ã‰chec" styleClass="tech-label"/>
                                    <Label fx:id="failureRateLabel" text="0.2%" styleClass="tech-value tech-failure"/>
                                </VBox>
                                <VBox spacing="8" styleClass="tech-metric" GridPane.columnIndex="0" GridPane.rowIndex="1">
                                    <Label text=" InteractivitÃ©" styleClass="tech-label"/>
                                    <Label fx:id="interactivityLabel" text="4.5/5" styleClass="tech-value tech-interactivity"/>
                                </VBox>
                                <VBox spacing="8" styleClass="tech-metric" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                    <Label text=" QualitÃ© Streaming" styleClass="tech-label"/>
                                    <Label fx:id="streamingQualityLabel" text="4.0/5" styleClass="tech-value tech-streaming"/>
                                </VBox>
                            </GridPane>
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>

            <!-- ==================== ONGLET FEEDBACK ==================== -->
            <Tab text=" Saisir Feedback" styleClass="feedback-tab">
                <ScrollPane fitToWidth="true" styleClass="main-scroll">
                    <VBox spacing="30" style="-fx-padding: 40;" alignment="TOP_CENTER">

                        <!-- Titre -->
                        <VBox spacing="10" alignment="CENTER">
                            <Label text=" Nouvelle Ã‰valuation QoE" styleClass="form-title"/>
                            <Label text="Votre avis nous aide Ã  amÃ©liorer nos services" styleClass="form-subtitle"/>
                        </VBox>

                        <!-- Formulaire Principal -->
                        <VBox spacing="30" maxWidth="700" styleClass="form-container">

                            <!-- Type de Service -->
                            <VBox spacing="10">
                                <HBox spacing="5">
                                    <Label text="Type de Service" styleClass="form-label"/>
                                    <Label text="*" styleClass="required-asterisk"/>
                                </HBox>
                                <ComboBox fx:id="serviceTypeCombo" prefWidth="620"
                                          promptText=" SÃ©lectionnez un service..."
                                          styleClass="modern-combo"/>
                                <Label text="Choisissez le type de service que vous avez utilisÃ©"
                                       styleClass="form-helper"/>
                            </VBox>

                            <!-- SystÃ¨me d'Ã‰toiles Interactif -->
                            <VBox spacing="15">
                                <HBox spacing="5">
                                    <Label text="Note de Satisfaction" styleClass="form-label"/>
                                    <Label text="*" styleClass="required-asterisk"/>
                                </HBox>
                                <Label text="Ã‰valuez votre expÃ©rience de 1 Ã  5 Ã©toiles" styleClass="form-helper"/>

                                <!-- Ã‰toiles cliquables -->
                                <HBox spacing="15" alignment="CENTER" styleClass="star-container">
<!--                                    <ToggleGroup fx:id="ratingGroup"/>-->

                                    <VBox spacing="8" alignment="CENTER" styleClass="star-wrapper">
                                        <RadioButton toggleGroup="$ratingGroup" userData="1" styleClass="star-radio">
                                            <graphic>
                                                <VBox alignment="CENTER" spacing="5">
                                                    <Label text="â­" styleClass="star-icon"/>
                                                    <Label text="1" styleClass="star-number"/>
                                                </VBox>
                                            </graphic>
                                        </RadioButton>
                                        <Label text="Mauvais" styleClass="star-label"/>
                                    </VBox>

                                    <VBox spacing="8" alignment="CENTER" styleClass="star-wrapper">
                                        <RadioButton toggleGroup="$ratingGroup" userData="2" styleClass="star-radio">
                                            <graphic>
                                                <VBox alignment="CENTER" spacing="5">
                                                    <Label text="â­â­" styleClass="star-icon"/>
                                                    <Label text="2" styleClass="star-number"/>
                                                </VBox>
                                            </graphic>
                                        </RadioButton>
                                        <Label text="Passable" styleClass="star-label"/>
                                    </VBox>

                                    <VBox spacing="8" alignment="CENTER" styleClass="star-wrapper">
                                        <RadioButton toggleGroup="$ratingGroup" userData="3" styleClass="star-radio">
                                            <graphic>
                                                <VBox alignment="CENTER" spacing="5">
                                                    <Label text="â­â­â­" styleClass="star-icon"/>
                                                    <Label text="3" styleClass="star-number"/>
                                                </VBox>
                                            </graphic>
                                        </RadioButton>
                                        <Label text="Bien" styleClass="star-label"/>
                                    </VBox>

                                    <VBox spacing="8" alignment="CENTER" styleClass="star-wrapper">
                                        <RadioButton toggleGroup="$ratingGroup" userData="4" styleClass="star-radio">
                                            <graphic>
                                                <VBox alignment="CENTER" spacing="5">
                                                    <Label text="â­â­â­â­" styleClass="star-icon"/>
                                                    <Label text="4" styleClass="star-number"/>
                                                </VBox>
                                            </graphic>
                                        </RadioButton>
                                        <Label text="TrÃ¨s bien" styleClass="star-label"/>
                                    </VBox>

                                    <VBox spacing="8" alignment="CENTER" styleClass="star-wrapper">
                                        <RadioButton toggleGroup="$ratingGroup" userData="5" styleClass="star-radio">
                                            <graphic>
                                                <VBox alignment="CENTER" spacing="5">
                                                    <Label text="â­â­â­â­â­" styleClass="star-icon"/>
                                                    <Label text="5" styleClass="star-number"/>
                                                </VBox>
                                            </graphic>
                                        </RadioButton>
                                        <Label text="Excellent" styleClass="star-label"/>
                                    </VBox>
                                </HBox>
                            </VBox>

                            <!-- Commentaires -->
                            <VBox spacing="10">
                                <Label text="Commentaires" styleClass="form-label"/>
                                <Label text="Partagez les dÃ©tails de votre expÃ©rience (optionnel)" styleClass="form-helper"/>
                                <TextArea fx:id="commentField"
                                          promptText=" Exemple: La qualitÃ© vidÃ©o Ã©tait excellente, mais j'ai remarquÃ© quelques coupures..."
                                          prefRowCount="5" wrapText="true"
                                          styleClass="modern-textarea"/>
                                <HBox spacing="5" alignment="CENTER_RIGHT">
                                    <Label text="0" styleClass="char-count"/>
                                    <Label text="/ 500 caractÃ¨res" styleClass="char-limit"/>
                                </HBox>
                            </VBox>

                            <!-- SÃ©parateur -->
                            <Separator styleClass="form-separator"/>

                            <!-- Boutons d'action -->
                            <HBox spacing="15" alignment="CENTER">
                                <Button text="Annuler" styleClass="secondary-button">
                                    <tooltip><Tooltip text="Effacer le formulaire"/></tooltip>
                                </Button>
                                <Button text="âœ“ Enregistrer l'Ã‰valuation" onAction="#submitFeedback"
                                        styleClass="primary-button">
                                    <tooltip><Tooltip text="Soumettre votre Ã©valuation"/></tooltip>
                                </Button>
                            </HBox>

                            <!-- Zone d'information -->
                            <HBox spacing="10" alignment="CENTER" styleClass="info-banner">
                                <Label text="â„¹ï¸" styleClass="info-icon"/>
                                <Label text="Vos Ã©valuations sont anonymisÃ©es et utilisÃ©es uniquement pour amÃ©liorer la qualitÃ© de service."
                                       styleClass="info-text" wrapText="true"/>
                            </HBox>
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>

            <!-- ==================== ONGLET HISTORIQUE ==================== -->
            <Tab text="ðŸ“‹ Historique" styleClass="history-tab">
                <VBox spacing="20" style="-fx-padding: 30; -fx-background-color: #fafafa;">
                    <VBox spacing="10">
                        <Label text="ðŸ“‹ Historique des Ã‰valuations" styleClass="section-title"/>
                        <Label text="Consultez toutes vos Ã©valuations passÃ©es" styleClass="section-subtitle"/>
                    </VBox>

                    <TableView fx:id="feedbackHistoryTable" styleClass="modern-table">
                        <columns>
                            <TableColumn text="ðŸ“… Date" prefWidth="200"/>
                            <TableColumn text="ðŸ”§ Service" prefWidth="180"/>
                            <TableColumn text="â­ Score QoE" prefWidth="140"/>
                            <TableColumn text="ðŸŽ¥ QualitÃ© VidÃ©o" prefWidth="150"/>
                            <TableColumn text="ðŸ”Š QualitÃ© Audio" prefWidth="150"/>
                        </columns>
                        <placeholder>
                            <VBox alignment="CENTER" spacing="15" styleClass="table-placeholder">
                                <Label text="ðŸ“­" styleClass="placeholder-icon"/>
                                <Label text="Aucune Ã©valuation pour le moment" styleClass="placeholder-title"/>
                                <Label text="Commencez Ã  Ã©valuer vos services dans l'onglet 'Saisir Feedback'"
                                       styleClass="placeholder-text"/>
                            </VBox>
                        </placeholder>
                    </TableView>
                </VBox>
            </Tab>
        </TabPane>
    </center>

</BorderPane>