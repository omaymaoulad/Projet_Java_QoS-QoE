<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.*?>
<?import javafx.scene.chart.*?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.ensah.qoe.Controller.AnomalyDashboardController"
            stylesheets="/css/dashboard-ml-Anomaly.css"
            styleClass="root">

    <!-- ===================== HEADER ===================== -->
    <top>
        <VBox styleClass="header">
            <HBox styleClass="header-content" alignment="CENTER_LEFT" spacing="30">
                <Label text="ðŸ” DÃ©tection d'Anomalies QoS/QoE" styleClass="header-title"/>

                <Region HBox.hgrow="ALWAYS"/>

                <HBox spacing="15" alignment="CENTER_RIGHT">
                    <Button fx:id="btnAccueil" text="ðŸ“Š Accueil"
                            onAction="#showAccueil"
                            styleClass="nav-btn-active"/>
                    <Button fx:id="btnPrediction" text="ðŸ”® PrÃ©diction"
                            onAction="#showPrediction"
                            styleClass="nav-btn"/>
                </HBox>
            </HBox>
        </VBox>
    </top>

    <!-- ===================== MAIN CONTENT ===================== -->
    <center>
        <StackPane fx:id="contentPane">

            <!-- ============== PAGE ACCUEIL ============== -->
            <ScrollPane fx:id="accueilScroll" fitToWidth="true"  styleClass="scroll-pane">
                <VBox fx:id="accueilPane" spacing="25" styleClass="main-content">
                    <padding>
                        <Insets top="30" right="30" bottom="30" left="30"/>
                    </padding>

                    <!-- Section EntraÃ®nement -->
                    <VBox spacing="15" styleClass="section">
                        <Label text="ðŸš€ EntraÃ®nement du ModÃ¨le" styleClass="section-title"/>
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <Button text="Lancer l'EntraÃ®nement"
                                    onAction="#handleTrain"
                                    styleClass="train-btn"/>
                            <Label text="Algorithme: Random Forest | Dataset: prediction_dataset.csv"
                                   styleClass="info-text"/>
                        </HBox>
                    </VBox>

                    <!-- Statistiques en cartes -->
                    <VBox spacing="15" styleClass="section">
                        <Label text="ðŸ“ˆ Statistiques du Dataset CSV" styleClass="section-title"/>

                        <GridPane hgap="20" vgap="20">
                            <!-- Carte 1: Total -->
                            <VBox styleClass="stat-card" GridPane.rowIndex="0" GridPane.columnIndex="0">
                                <Label text="ðŸ“Š Total Instances" styleClass="card-label"/>
                                <Label fx:id="totalInstancesLabel" text="--" styleClass="card-value"/>
                                <Label text="Lignes dans le CSV" styleClass="card-subtitle"/>
                            </VBox>

                            <!-- Carte 2: Normal -->
                            <VBox styleClass="stat-card stat-card-success" GridPane.rowIndex="0" GridPane.columnIndex="1">
                                <Label text="âœ… Instances Normales" styleClass="card-label"/>
                                <Label fx:id="normalCountLabel" text="--" styleClass="card-value"/>
                                <Label text="Comportement normal" styleClass="card-subtitle"/>
                            </VBox>

                            <!-- Carte 3: Anomalies -->
                            <VBox styleClass="stat-card stat-card-danger" GridPane.rowIndex="0" GridPane.columnIndex="2">
                                <Label text="âš ï¸ Anomalies DÃ©tectÃ©es" styleClass="card-label"/>
                                <Label fx:id="anomalyCountLabel" text="--" styleClass="card-value"/>
                                <Label text="NÃ©cessitent attention" styleClass="card-subtitle"/>
                            </VBox>

                            <!-- Carte 4: Accuracy -->
                            <VBox styleClass="stat-card stat-card-info" GridPane.rowIndex="0" GridPane.columnIndex="3">
                                <Label text="ðŸŽ¯ PrÃ©cision ModÃ¨le" styleClass="card-label"/>
                                <Label fx:id="accuracyLabel" text="--" styleClass="card-value"/>
                                <Label text="Performance globale" styleClass="card-subtitle"/>
                            </VBox>
                        </GridPane>
                    </VBox>

                    <!-- Graphiques -->
                    <VBox spacing="15" styleClass="section">
                        <Label text="ðŸ“‰ Analyse Visuelle des Features" styleClass="section-title"/>
                        <Label text="Visualisation de la corrÃ©lation entre diffÃ©rentes mÃ©triques QoS"
                               styleClass="info-text"/>

                        <GridPane hgap="20" vgap="20">
                            <!-- Graphique 1 -->
                            <VBox styleClass="chart-container" GridPane.rowIndex="0" GridPane.columnIndex="0">
                                <ScatterChart fx:id="chart1" legendVisible="true" animated="false">
                                    <xAxis>
                                        <NumberAxis label="Latence (ms)" side="BOTTOM" autoRanging="true"/>
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis label="Jitter (ms)" side="LEFT" autoRanging="true"/>
                                    </yAxis>
                                </ScatterChart>
                            </VBox>

                            <!-- Graphique 2 -->
                            <VBox styleClass="chart-container" GridPane.rowIndex="0" GridPane.columnIndex="1">
                                <ScatterChart fx:id="chart2" legendVisible="true" animated="false">
                                    <xAxis>
                                        <NumberAxis label="Bande passante (Mbps)" side="BOTTOM" autoRanging="true"/>
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis label="Perte " side="LEFT" autoRanging="true"/>
                                    </yAxis>
                                </ScatterChart>
                            </VBox>

                            <!-- Graphique 3 -->
                            <VBox styleClass="chart-container" GridPane.rowIndex="1" GridPane.columnIndex="0" GridPane.columnSpan="2">
                                <ScatterChart fx:id="chart3" legendVisible="true" animated="false">
                                    <xAxis>
                                        <NumberAxis label="Score Signal (0-100)" side="BOTTOM" autoRanging="true"/>
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis label="Latence (ms)" side="LEFT" autoRanging="true"/>
                                    </yAxis>
                                </ScatterChart>
                            </VBox>
                        </GridPane>
                    </VBox>

                    <!-- Tableau des zones -->
                    <VBox spacing="15" styleClass="section">
                        <Label text="ðŸ—º Analyse par Zone GÃ©ographique" styleClass="section-title"/>
                        <Label text="Statistiques d'anomalies par zone "
                               styleClass="info-text"/>

                        <TableView fx:id="zoneTable" styleClass="data-table">
                            <columns>
                                <TableColumn fx:id="colZone" text="Zone" prefWidth="200"/>
                                <TableColumn fx:id="colNormal" text="Normal" prefWidth="120"/>
                                <TableColumn fx:id="colAnomaly" text="Anomalies" prefWidth="120"/>
                                <TableColumn fx:id="colTotal" text="Total" prefWidth="100"/>
                                <TableColumn fx:id="colStatus" text="Statut" prefWidth="180"/>
                            </columns>
                        </TableView>
                    </VBox>
                </VBox>
            </ScrollPane>

            <!-- ============== PAGE PREDICTION ============== -->
            <ScrollPane fx:id="predictionScroll" fitToWidth="true" styleClass="scroll-pane" visible="false" managed="false">
                <HBox alignment="CENTER">
                    <VBox fx:id="predictionPane" spacing="30" styleClass="main-content"
                          maxWidth="900">
                        <padding>
                             <Insets top="40" right="40" bottom="40" left="100"/>
                        </padding>

                    <!-- Titre principal -->
                        <VBox spacing="8" alignment="CENTER">
                            <Label text="ðŸ”® PrÃ©diction d'Anomalie QoS" styleClass="prediction-title"/>
                            <Label text="Analysez vos mÃ©triques rÃ©seau en temps rÃ©el avec Machine Learning"
                               styleClass="prediction-subtitle"/>
                        </VBox>

                    <!-- Formulaire de prÃ©diction -->
                        <VBox styleClass="prediction-form" spacing="25" maxWidth="700" alignment="CENTER">
                            <Label text="ðŸ“ ParamÃ¨tres RÃ©seau" styleClass="form-section-title"/>

                            <GridPane hgap="20" vgap="20">
                                <columnConstraints>
                                    <ColumnConstraints percentWidth="40"/>
                                    <ColumnConstraints percentWidth="50"/>
                                    <ColumnConstraints percentWidth="10"/>
                                </columnConstraints>

                            <!-- Latence -->
                                <Label text="ðŸ“¡ Latence RÃ©seau"
                                   GridPane.rowIndex="0" GridPane.columnIndex="0"
                                   styleClass="form-label"/>
                                <TextField fx:id="latField"
                                       promptText="Ex: 50"
                                       GridPane.rowIndex="0" GridPane.columnIndex="1"
                                       styleClass="form-input"/>
                                <Label text="ms"
                                   GridPane.rowIndex="0" GridPane.columnIndex="2"
                                   styleClass="unit-label"/>

                            <!-- Jitter -->
                                <Label text="ðŸ“Š Jitter"
                                   GridPane.rowIndex="1" GridPane.columnIndex="0"
                                   styleClass="form-label"/>
                                <TextField fx:id="jitField"
                                       promptText="Ex: 10"
                                       GridPane.rowIndex="1" GridPane.columnIndex="1"
                                       styleClass="form-input"/>
                                <Label text="ms"
                                   GridPane.rowIndex="1" GridPane.columnIndex="2"
                                   styleClass="unit-label"/>

                            <!-- Perte -->
                                <Label text="ðŸ“‰ Perte de Paquets"
                                   GridPane.rowIndex="2" GridPane.columnIndex="0"
                                   styleClass="form-label"/>
                                <TextField fx:id="lossField"
                                       promptText="Ex: 1.5"
                                       GridPane.rowIndex="2" GridPane.columnIndex="1"
                                       styleClass="form-input"/>
                                <Label text=" "
                                   GridPane.rowIndex="2" GridPane.columnIndex="2"
                                   styleClass="unit-label"/>

                            <!-- Bande passante -->
                                <Label text="ðŸŒ Bande Passante"
                                   GridPane.rowIndex="3" GridPane.columnIndex="0"
                                   styleClass="form-label"/>
                                <TextField fx:id="bwField"
                                       promptText="Ex: 100"
                                       GridPane.rowIndex="3" GridPane.columnIndex="1"
                                       styleClass="form-input"/>
                                <Label text="Mbps"
                                   GridPane.rowIndex="3" GridPane.columnIndex="2"
                                   styleClass="unit-label"/>

                            <!-- Signal -->
                                <Label text="ðŸ“¶ QualitÃ© Signal"
                                   GridPane.rowIndex="4" GridPane.columnIndex="0"
                                   styleClass="form-label"/>
                                <TextField fx:id="sigField"
                                       promptText="0 - 100"
                                       GridPane.rowIndex="4" GridPane.columnIndex="1"
                                       styleClass="form-input"/>
                                <Label text=""
                                   GridPane.rowIndex="4" GridPane.columnIndex="2"/>
                            </GridPane>

                        <!-- Bouton PrÃ©dire -->
                            <HBox alignment="CENTER" spacing="15">
                                <Button text="ðŸ” Analyser"
                                    onAction="#handlePredict"
                                    styleClass="predict-btn"/>
                                <ProgressIndicator fx:id="loadingIndicator"
                                               visible="false"
                                               prefWidth="30" prefHeight="30"/>
                            </HBox>
                         </VBox>

                    <!-- RÃ©sultat -->
                        <VBox styleClass="result-card" spacing="20" alignment="CENTER" maxWidth="700">
                            <Label text="ðŸ“Š RÃ©sultat de l'Analyse" styleClass="result-title"/>

                            <HBox spacing="40" alignment="CENTER">
                                <VBox alignment="CENTER" spacing="8">
                                    <Label text="PrÃ©diction" styleClass="result-label-text"/>
                                    <Label fx:id="predictionLabel" text="--"
                                       styleClass="result-value"/>
                                </VBox>

                                <Separator orientation="VERTICAL" prefHeight="60"/>

                                <VBox alignment="CENTER" spacing="8">
                                    <Label text="Confiance" styleClass="result-label-text"/>
                                    <Label fx:id="confidenceLabel" text="--"
                                       styleClass="confidence-value"/>
                                </VBox>
                            </HBox>
                        </VBox>

                    <!-- Information sur les anomalies -->
                        <VBox styleClass="info-box" spacing="15" maxWidth="800">
                            <Label text="ðŸ’¡ Qu'est-ce qu'une Anomalie RÃ©seau ?" styleClass="info-title"/>

                            <VBox spacing="12">
                                <Label text="Une anomalie rÃ©seau reprÃ©sente un comportement inhabituel ou dÃ©gradÃ© dans les performances du rÃ©seau qui peut affecter nÃ©gativement l'expÃ©rience utilisateur (QoE - Quality of Experience)."
                                   wrapText="true" styleClass="info-text"/>

                                <Label text="ðŸ“‹ Indicateurs d'Anomalie :" styleClass="info-subtitle"/>
                                <VBox spacing="6" styleClass="info-list">
                                    <Label text=" Latence Ã©levÃ©e (plus grand de 150ms) : Retards dans la transmission des donnÃ©es, affectant la rÃ©activitÃ©"
                                       wrapText="true" styleClass="info-item"/>
                                    <Label text=" Jitter important (plus grand de 30ms) : Variation instable du dÃ©lai, causant des coupures audio/vidÃ©o"
                                       wrapText="true" styleClass="info-item"/>
                                    <Label text="Perte de paquets (plus petit de  3) : DonnÃ©es non reÃ§ues, nÃ©cessitant des retransmissions"
                                       wrapText="true" styleClass="info-item"/>
                                    <Label text=" Bande passante faible (plus petit de 50 Mbps) : DÃ©bit insuffisant pour les applications gourmandes"
                                       wrapText="true" styleClass="info-item"/>
                                    <Label text=" Signal dÃ©gradÃ© (plus petit que 60 pour cent) : QualitÃ© de connexion mÃ©diocre, instabilitÃ© rÃ©seau"
                                       wrapText="true" styleClass="info-item"/>
                                </VBox>
                                <Separator/>
                                <Label text="ðŸŽ¯ Quand une zone est-elle considÃ©rÃ©e comme anomale ?" styleClass="info-subtitle"/>
                                <Label text="Une zone est classÃ©e comme anomale lorsqu'elle prÃ©sente plusieurs de ces indicateurs simultanÃ©ment, dÃ©passant les seuils acceptables. Notre modÃ¨le de Machine Learning (Random Forest) analyse ces patterns complexes pour identifier les anomalies avec une grande prÃ©cision."
                                   wrapText="true" styleClass="info-text"/>
                                <Label text="âš  Impact sur l'utilisateur : Lorsqu'une anomalie est dÃ©tectÃ©e, cela peut entraÃ®ner des coupures de service, du buffering vidÃ©o, une qualitÃ© audio/vidÃ©o dÃ©gradÃ©e, des dÃ©connexions frÃ©quentes, ou une navigation web lente."
                                   wrapText="true" styleClass="info-text"/>
                            </VBox>
                        </VBox>
                    </VBox>
                </HBox>
            </ScrollPane>

        </StackPane>
    </center>

</BorderPane>