<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.*?>
<?import javafx.geometry.Insets?>
<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.ensah.qoe.Controller.AnomalyDashboardController"
            stylesheets="@css/dashboard-ml-Anomaly.css">

    <!-- ===================== HEADER ===================== -->
    <top>
        <VBox styleClass="header">
            <Label text="QoS / QoE – Anomaly Detection Dashboard"
                   styleClass="header-title"/>

            <MenuBar>
                <Menu text="Navigation">
                    <MenuItem fx:id="menuTrain" text="Entraînement"
                              onAction="#showTrain"/>
                    <MenuItem fx:id="menuPredict" text="Prédiction"
                              onAction="#showPredict"/>
                    <MenuItem fx:id="menuEvaluate" text="Évaluation"
                              onAction="#showEvaluate"/>
                </Menu>
            </MenuBar>
        </VBox>
    </top>

    <!-- ===================== MAIN CONTENT ===================== -->
    <center>

        <!-- STACKPANE OBLIGATOIRE POUR LE CONTROLLER -->
        <StackPane fx:id="contentPane">
            <padding>
                <Insets top="25" right="25" bottom="25" left="25"/>
            </padding>

            <!-- ===================== TRAIN PANE ===================== -->
            <VBox fx:id="trainPane" spacing="15" maxWidth="700"
                  styleClass="card">

                <Label text="Entraînement du modèle (Random Forest)"
                       styleClass="card-title"/>

                <Button text="Lancer l'entraînement"
                        fx:id="trainButton"
                        onAction="#handleTrain"
                        styleClass="primary-btn"/>

                <TextArea fx:id="trainingLog"
                          prefHeight="180"
                          editable="false"/>
            </VBox>

            <!-- ===================== PREDICT PANE ===================== -->
            <VBox fx:id="predictPane"
                  spacing="20"
                  visible="false"
                  managed="false"
                  styleClass="card">
                 <padding>
                    <Insets top="25" right="25" bottom="25" left="25"/>
                 </padding>
                <!-- Titre -->
                <Label text="Prédiction d'anomalie QoS"
                       styleClass="card-title"/>

                <Label text="Veuillez saisir les paramètres réseau mesurés pour détecter une anomalie."
                       styleClass="subtitle"/>

                <!-- Formulaire -->
                <GridPane hgap="15" vgap="14">

                    <!-- LATENCE -->
                    <Label text="Latence réseau"
                           GridPane.rowIndex="0" GridPane.columnIndex="0"
                           styleClass="form-label"/>
                    <TextField fx:id="latField"
                               promptText="Ex: 50"
                               GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                    <Label text="ms"
                           GridPane.rowIndex="0" GridPane.columnIndex="2"
                           styleClass="unit-label"/>

                    <!-- JITTER -->
                    <Label text="Jitter"
                           GridPane.rowIndex="1" GridPane.columnIndex="0"
                           styleClass="form-label"/>
                    <TextField fx:id="jitField"
                               promptText="Ex: 10"
                               GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                    <Label text="ms"
                           GridPane.rowIndex="1" GridPane.columnIndex="2"
                           styleClass="unit-label"/>

                    <!-- PERTE -->
                    <Label text="Perte de paquets"
                           GridPane.rowIndex="2" GridPane.columnIndex="0"
                           styleClass="form-label"/>
                    <TextField fx:id="lossField"
                               promptText="Ex: 1.5"
                               GridPane.rowIndex="2" GridPane.columnIndex="1"/>
                    <Label text=" "
                           GridPane.rowIndex="2" GridPane.columnIndex="2"
                           styleClass="unit-label"/>

                    <!-- BANDE PASSANTE -->
                    <Label text="Bande passante"
                           GridPane.rowIndex="3" GridPane.columnIndex="0"
                           styleClass="form-label"/>
                    <TextField fx:id="bwField"
                               promptText="Ex: 100"
                               GridPane.rowIndex="3" GridPane.columnIndex="1"/>
                    <Label text="Mbps"
                           GridPane.rowIndex="3" GridPane.columnIndex="2"
                           styleClass="unit-label"/>

                    <!-- SIGNAL -->
                    <Label text="Qualité du signal"
                           GridPane.rowIndex="4" GridPane.columnIndex="0"
                           styleClass="form-label"/>
                    <TextField fx:id="sigField"
                               promptText="0 - 100"
                               GridPane.rowIndex="4" GridPane.columnIndex="1"/>
                    <Label text=" "
                           GridPane.rowIndex="4" GridPane.columnIndex="2"
                           styleClass="unit-label"/>

                </GridPane>

                <!-- Bouton -->
                <Button text="Analyser et prédire"
                        onAction="#handlePredict"
                        styleClass="primary-btn"
                        maxWidth="220"/>

                <!-- Résultat -->
                <Separator/>

                <HBox spacing="15" alignment="CENTER_LEFT">

                    <Label text="Résultat :"
                           styleClass="result-label"/>

                    <Label fx:id="predictionLabel"
                           text="--"
                           styleClass="result-value"/>

                    <Label text="Confiance :"
                           styleClass="result-label"/>

                    <Label fx:id="confidenceLabel"
                           text="--"
                           styleClass="confidence-value"/>

                </HBox>

            </VBox>

            <!-- ===================== EVALUATE PANE ===================== -->
            <VBox fx:id="evaluatePane" spacing="15" maxWidth="700"
                  visible="false" managed="false"
                  styleClass="card">

                <Label text="Évaluation du modèle"
                       styleClass="card-title"/>

                <GridPane hgap="20" vgap="10">
                    <Label text="Accuracy"/>
                    <Label fx:id="accLabel"/>

                    <Label text="Precision" GridPane.rowIndex="1"/>
                    <Label fx:id="precLabel" GridPane.rowIndex="1"/>

                    <Label text="Recall" GridPane.rowIndex="2"/>
                    <Label fx:id="recallLabel" GridPane.rowIndex="2"/>

                    <Label text="F1-score" GridPane.rowIndex="3"/>
                    <Label fx:id="f1Label" GridPane.rowIndex="3"/>
                </GridPane>

                <Button text="Évaluer le modèle"
                        onAction="#handleEvaluate"
                        styleClass="primary-btn"/>

                <TextArea fx:id="evalLog"
                          prefHeight="200"
                          editable="false"/>
            </VBox>

        </StackPane>
    </center>

</BorderPane>
